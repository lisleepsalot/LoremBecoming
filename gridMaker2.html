<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GridMaker 2</title>
  <link rel="stylesheet" href="page_style.css">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      background-image: none;
    }

    #gridMaker2 {
      margin-top:20px;
      padding: 32px;
      width: 100vw;
      height: 100vh;
      box-sizing: border-box;
      font-family: monospace;
      font-size: 0.7rem;
      line-height: 1.4;
      white-space: pre-wrap;
      overflow: auto;
    }


    .labels .active {
      font-weight: bold;
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <div class="floating-window">
    <div class="heading">
    <a href="index.html">Back</a>
    <a href="index.html"></a>
    </div>
    <div class="content">
        <span>GridMaker2</span>
        <div class="description">Make a grid by clicking. You are now the God of Rectangles.<br><br>
          Instruction: Click. A grid appears. Keep going. You are the algorithm. (Horizontal is a bit buggy)
        </div>
        <div class="labels">
          <input type="radio" id="vertical" name="direction" value="vertical" checked>
          <label for="vertical">Vertical</label>
          <input type="radio" id="horizontal" name="direction" value="horizontal">
          <label for="horizontal">Horizontal</label>
        </div>
        <div class="controls">
          <button id="reset-button">Reset</button>
        </div>
    </div>
    <div id="arrow">
      ↓for info↓
    </div>
</div>

  <div id="gridMaker2">
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas enim odio, finibus at cursus sit amet, varius eget velit. Ut vitae iaculis mi. Sed mattis nec turpis vitae congue. Vestibulum vulputate dolor ac suscipit vestibulum. Duis fringilla tellus sit amet magna mattis eleifend. Morbi eget hendrerit turpis. Curabitur dapibus aliquet tellus, vitae luctus purus. Aenean eget risus at turpis sodales tristique a nec erat. Nunc non mi sed dolor rutrum blandit nec sed metus. In pretium neque pharetra ullamcorper consectetur.

Duis a neque consequat mauris egestas pharetra. Vivamus et rutrum leo. Morbi malesuada placerat lorem ac feugiat. Nam id ante et elit venenatis consequat. In ut diam mi. Cras rutrum neque nec tortor consequat suscipit. Phasellus maximus vitae ipsum vitae mollis. Maecenas vel metus felis. Duis eleifend id quam at auctor. Cras ac congue ex. Donec ultrices augue vel quam ultrices, non sagittis mauris tristique. Donec et est vel risus dictum commodo non consectetur nisl.

Sed et pellentesque risus. Cras leo erat, pharetra et sollicitudin at, auctor et ipsum. Fusce auctor lacus ac iaculis hendrerit. Praesent in pharetra lorem, eu blandit enim. Nulla turpis lacus, pharetra molestie diam consequat, mollis porta quam. Phasellus feugiat mollis rhoncus. Donec ac ipsum ligula. Etiam arcu sapien, suscipit eget tristique eleifend, porttitor et tortor. Integer pretium consequat nulla, sit amet gravida quam. Phasellus consectetur ex vel vulputate mollis. Proin libero tellus, scelerisque eget justo eu, ultrices elementum justo. Aliquam maximus tincidunt turpis id commodo. Donec felis arcu, pharetra at dui et, dapibus commodo massa. Aliquam aliquet quam nunc, quis consequat ipsum consectetur at. Donec ac rutrum magna.

Phasellus eget diam id mauris sagittis convallis. In fermentum sodales lorem, id malesuada diam ullamcorper ut. Integer vehicula lorem at est ornare, non eleifend tortor mollis. Proin tempor varius metus, lacinia pulvinar purus consequat ut. Mauris quis mauris venenatis, gravida magna vel, aliquet elit. Mauris dignissim, turpis nec placerat elementum, turpis odio sodales sapien, eget varius velit orci at nibh. Nulla quis orci in enim semper ultrices et vel felis. Phasellus at libero porta odio imperdiet varius in id metus. In et venenatis libero, id bibendum tellus.

Vestibulum dignissim nunc non pretium cursus. Nulla maximus nunc posuere placerat imperdiet. Pellentesque hendrerit eros quis libero vestibulum suscipit. Aenean at auctor diam. In quam eros, porttitor ac venenatis ut, porttitor ac risus. Fusce bibendum nulla ac consectetur pellentesque. Aenean fringilla elit at enim tincidunt iaculis. Vivamus nec ultrices libero. Donec sed elit tellus.

Integer nec erat id purus finibus posuere. Maecenas ultrices nibh ac enim vestibulum eleifend vitae eget risus. Phasellus eu dui mauris. Duis egestas metus ex, sit amet rutrum lorem tristique et. Nullam iaculis sapien eget leo efficitur, quis vulputate metus fringilla. Etiam molestie, libero sit amet pulvinar egestas, nunc ante dapibus ex, non placerat ligula felis sit amet ligula. Suspendisse rhoncus bibendum nunc ut mattis. Donec commodo, libero non lacinia bibendum, mi dolor lobortis ligula, sit amet maximus diam nisi vel purus. Aenean ac justo erat. Interdum et malesuada fames ac ante ipsum primis in faucibus.

Praesent quis luctus enim. Ut pharetra viverra leo non fringilla. Nunc et libero eget lorem auctor iaculis. Aenean semper sem rhoncus pellentesque vehicula. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Praesent mollis dui risus, in fringilla nunc suscipit sed. Fusce rhoncus volutpat tincidunt. In iaculis lacus at lorem fringilla porta. Duis volutpat blandit fermentum. Fusce finibus tristique purus.

Etiam tempor ac dolor at consequat. Proin feugiat, metus vel accumsan fermentum, diam ligula pulvinar metus, vitae fermentum augue sapien vel odio. Integer ex magna, eleifend non elit eu, commodo iaculis ante. Mauris ultricies purus a lacinia mollis. Maecenas vel nisi euismod, varius nisl et, eleifend risus. Mauris sollicitudin quis tellus sit amet commodo. Suspendisse quis diam ultrices lacus interdum imperdiet eget sed lorem. Nunc mattis neque mi, ut sollicitudin tortor pulvinar vel. Duis id malesuada tortor, eu varius libero. Aliquam nulla metus, ultricies ac ornare condimentum, dapibus at nisi.

Nam accumsan laoreet augue at blandit. Quisque elementum convallis ipsum vel tincidunt. Donec malesuada felis ante. Phasellus ac diam non augue tincidunt mollis vitae ac ante. Ut luctus aliquam egestas. Proin imperdiet bibendum mi, sit amet vulputate tellus vulputate nec. Cras vel finibus quam. Vestibulum volutpat sed nulla non rhoncus. Quisque vulputate lorem in fringilla pulvinar. Donec dignissim pulvinar lorem. Fusce nec lacus nec magna pretium ullamcorper quis ac nisl. Curabitur et felis et arcu ornare vestibulum quis quis nunc. Donec ut massa sagittis, blandit risus ac, varius velit. Vivamus tristique, diam quis viverra hendrerit, libero augue porta tortor, vel consequat orci elit at nunc. Nunc eu nisl feugiat, malesuada lacus a, auctor lorem.

Phasellus vitae eros ac ipsum blandit tristique. Sed id mi mi. Nulla sit amet cursus leo. Pellentesque maximus a sapien eget semper. Morbi blandit purus purus, quis lacinia turpis tempus cursus. Nam ut porttitor dui. Vestibulum lacinia dui nisi, a dictum nunc elementum sed. Aliquam id orci sed quam iaculis consequat vitae eget ante. Praesent a nisl egestas, consectetur velit quis, bibendum nisl. Aenean tellus orci, convallis quis nunc in, dignissim tincidunt lectus. Nullam vel facilisis leo. Quisque semper risus velit, nec vehicula nibh vehicula ut. Ut finibus urna at dignissim egestas. Integer rutrum et enim eget posuere.

Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Quisque vehicula elit id nisl iaculis, ac laoreet augue vulputate. Duis nisi odio, commodo vel odio et, consequat varius nisi. Curabitur mollis molestie ipsum, ac semper quam. Quisque quis tortor augue. In pellentesque lorem justo, et sodales nulla porttitor vel. Proin nec felis non nisi vulputate faucibus sit amet nec nisi. Praesent nisl sem, fermentum sit amet velit eleifend, hendrerit luctus justo. Ut eu lacus sem. Duis id nulla euismod, aliquet lacus ut, mollis tellus. In ut tellus dapibus, dignissim tellus vitae, dapibus neque. Etiam maximus, sem sit amet accumsan mattis, est enim congue lectus, eget aliquet nibh quam eget sapien. Duis gravida orci ac nisl consequat mollis.

Vivamus tempor sodales tortor, vitae iaculis ipsum suscipit eu. Nullam consectetur elit id lorem tristique tempus. Curabitur lobortis mattis mauris, eget vestibulum neque dictum sed. Donec vel fermentum justo. Nulla sollicitudin, ipsum non condimentum suscipit, ex est maximus orci, non molestie dui turpis nec odio. Vestibulum turpis diam, congue sed auctor quis, elementum id mi. Ut id ornare augue, et tempus orci. Pellentesque luctus nunc vulputate accumsan pharetra. Aliquam blandit lacinia justo. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.

Donec hendrerit massa at ultrices pulvinar. Suspendisse non convallis massa, vestibulum auctor augue. Curabitur rhoncus risus erat, fringilla lobortis nulla vestibulum eget. Curabitur in tempor nulla. Quisque placerat, est vitae scelerisque mollis, est nunc facilisis sem, eget faucibus orci massa sed lectus. Vivamus tempus bibendum purus id mollis. Interdum et malesuada fames ac ante ipsum primis in faucibus. Maecenas sit amet enim urna. Vestibulum ut cursus nisl. Fusce pellentesque ac ex eleifend fringilla.

Aenean porta, diam ut convallis efficitur, ante sem hendrerit tortor, at vestibulum purus neque et tellus. Curabitur suscipit dui at lacus vulputate vulputate. Phasellus elementum nibh ipsum, nec rhoncus tellus venenatis in. Phasellus id congue nisl. Maecenas in urna metus. Pellentesque at mi quis nunc luctus gravida in quis enim. Sed consequat, turpis in elementum ornare, nisl felis dictum erat, eu hendrerit diam tellus id elit. Integer tristique mi at luctus gravida.

Etiam dui mi, ultricies eu auctor quis, egestas vel justo. Integer non lobortis enim. In sit amet felis erat. Quisque id tellus vitae nisi pharetra tempor eget ac libero. Aenean augue orci, dignissim quis rutrum vel, iaculis sed magna. Cras ultrices justo velit, tempus semper massa molestie vitae. Suspendisse potenti. Nam sit amet feugiat sapien. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.

Curabitur interdum gravida sapien. Aenean at tempus nisi. Phasellus sapien urna, venenatis nec turpis quis, vestibulum aliquam lacus. Nullam vulputate egestas nunc sit amet feugiat. Morbi vel arcu a leo vehicula ornare vel in ligula. Nam tincidunt suscipit elit sed fermentum. Suspendisse ac commodo quam. Duis et diam sapien. Morbi tincidunt orci sed eros interdum, vitae ullamcorper dui tristique. Nam convallis gravida sem, vel gravida nisl dictum id. Quisque viverra lorem ut hendrerit varius.

Mauris quis purus augue. Quisque at tortor et ante bibendum semper eget non justo. Phasellus augue nisl, cursus dictum erat in, consectetur tristique nisl. In sodales sapien eu eleifend maximus. In eget massa in tellus sagittis cursus in sodales odio. Morbi quis viverra nibh. Proin nec rhoncus sapien, ac pharetra dolor. Fusce a leo sit amet turpis lobortis semper ut sit amet turpis. Nunc ac elit ultricies, dictum sapien id, auctor nunc. Morbi varius est et urna tempor tincidunt. Quisque sed eros vitae eros semper egestas. Aliquam est elit, consectetur eget nisl eu, posuere scelerisque tellus.
  </div>

  <script>
  // Utility function to measure how much text fits in a given dimension and size
  function measureTextFit(text, dimension, maxSize) {
    const testDiv = document.createElement("div");
    testDiv.style.position = "absolute";
    testDiv.style.visibility = "hidden";
    testDiv.style[dimension] = maxSize;
    testDiv.style.width = dimension === "height" ? "100%" : maxSize;
    testDiv.style.height = dimension === "width" ? "100%" : maxSize;
    testDiv.style.fontFamily = "monospace";
    testDiv.style.fontSize = "0.7rem";
    testDiv.style.lineHeight = "1.4";
    testDiv.style.whiteSpace = "pre-wrap";
    testDiv.style.overflow = "auto";
    document.body.appendChild(testDiv);

    let low = 0;
    let high = text.length;
    let best = 0;

    while (low <= high) {
      const mid = Math.floor((low + high) / 2);
      testDiv.innerText = text.slice(0, mid);
      if (dimension === "height" && testDiv.scrollHeight <= testDiv.clientHeight ||
          dimension === "width" && testDiv.scrollWidth <= testDiv.clientWidth) {
        best = mid;
        low = mid + 1;
      } else {
        high = mid - 1;
      }
    }

    document.body.removeChild(testDiv);
    return best;
  }

  let currentMode = "vertical";

  document.getElementById("vertical").addEventListener("change", () => {
    currentMode = "vertical";
  });

  document.getElementById("horizontal").addEventListener("change", () => {
    currentMode = "horizontal";
  });

  const gridDiv = document.getElementById("gridMaker2");

  let splitPoints = [];

let rowSplitPoints = [];

gridDiv.addEventListener("click", (e) => {
  if (currentMode !== "vertical" && currentMode !== "horizontal") return;

  const columns = Array.from(gridDiv.children);
  const fullText = columns.length > 0
    ? columns.map(col => col.innerText).join("")
    : gridDiv.innerText;
  const rect = gridDiv.getBoundingClientRect();
  // pixel-based calculation for vertical split
  let ratio, ratioY;
  if (currentMode === "vertical") {
    const clickX = e.clientX - rect.left + gridDiv.scrollLeft;
    ratio = clickX / gridDiv.clientWidth;
  } else {
    ratioY = (e.clientY - rect.top + gridDiv.scrollTop) / gridDiv.scrollHeight;
  }
  const GAP_THRESHOLD = 0.02;

  const targetPoints = currentMode === "vertical" ? splitPoints : (window.rowSplitPoints ||= rowSplitPoints);
  if (targetPoints.some(r => Math.abs(r - (currentMode === "vertical" ? ratio : ratioY)) < GAP_THRESHOLD)) return;

  targetPoints.push(currentMode === "vertical" ? ratio : ratioY);
  targetPoints.sort((a, b) => a - b);

  if (currentMode === "vertical") {
    const percentages = [...targetPoints, 1];
    const contentChunks = [];
    let lastRatio = 0;
    for (const ratio of percentages) {
      const start = Math.floor(fullText.length * lastRatio);
      const end = Math.floor(fullText.length * ratio);
      contentChunks.push(fullText.slice(start, end));
      lastRatio = ratio;
    }

    gridDiv.innerHTML = "";
    gridDiv.style.display = "grid";
    gridDiv.style.overflow = "auto";
    gridDiv.style.gridTemplateColumns =
      targetPoints.reduce((cols, r, i, arr) => {
        const pct = Math.round((i === 0 ? r : r - arr[i - 1]) * 100);
        return cols + `${pct}% 20px `;
      }, "") +
      `${Math.round((1 - targetPoints[targetPoints.length - 1]) * 100)}%`;

    const estimatedLimit = currentMode === "vertical"
      ? Math.floor(100 * window.innerHeight / 14)  // approx 14px line height
      : Math.floor(100 * window.innerWidth / 7);   // approx 7px char width

    contentChunks.forEach((chunk, i) => {
      let chunkIndex = 0;
      while (chunkIndex < chunk.length) {
        const fitCount = measureTextFit(
          chunk.slice(chunkIndex),
          currentMode === "vertical" ? "height" : "width",
          currentMode === "vertical" ? "100vh" : "100vw"
        );
        const part = chunk.slice(chunkIndex, chunkIndex + fitCount);
        const div = document.createElement("div");
        div.innerText = part;
        div.style.whiteSpace = "pre-wrap";
        div.style.overflow = "hidden";
        if (currentMode === "vertical") div.style.maxHeight = "100vh";
        else div.style.maxWidth = "100vw";
        gridDiv.appendChild(div);
        chunkIndex += fitCount;
      }
      if (i < contentChunks.length - 1) {
        const gap = document.createElement("div");
        gap.style.width = "20px";
        gridDiv.appendChild(gap);
      }
    });
  } else {
    const percentages = [...targetPoints, 1];
    const contentChunks = [];
    let lastRatio = 0;
    for (const ratio of percentages) {
      const start = Math.floor(fullText.length * lastRatio);
      const end = Math.floor(fullText.length * ratio);
      contentChunks.push(fullText.slice(start, end));
      lastRatio = ratio;
    }

    gridDiv.innerHTML = "";
    gridDiv.style.display = "grid";
    gridDiv.style.overflow = "auto";
    gridDiv.style.gridTemplateRows =
      targetPoints.reduce((rows, r, i, arr) => {
        const pct = Math.round((i === 0 ? r : r - arr[i - 1]) * 100);
        return rows + `${pct}% 20px `;
      }, "") +
      `${Math.round((1 - targetPoints[targetPoints.length - 1]) * 100)}%`;

    const estimatedLimit = currentMode === "vertical"
      ? Math.floor(100 * window.innerHeight / 14)  // approx 14px line height
      : Math.floor(100 * window.innerWidth / 7);   // approx 7px char width

    contentChunks.forEach((chunk, i) => {
      let chunkIndex = 0;
      while (chunkIndex < chunk.length) {
        const fitCount = measureTextFit(
          chunk.slice(chunkIndex),
          currentMode === "vertical" ? "height" : "width",
          currentMode === "vertical" ? "100vh" : "100vw"
        );
        const part = chunk.slice(chunkIndex, chunkIndex + fitCount);
        const div = document.createElement("div");
        div.innerText = part;
        div.style.whiteSpace = "pre-wrap";
        div.style.overflow = "hidden";
        if (currentMode === "vertical") div.style.maxHeight = "100vh";
        else div.style.maxWidth = "100vw";
        gridDiv.appendChild(div);
        chunkIndex += fitCount;
      }
      if (i < contentChunks.length - 1) {
        const gap = document.createElement("div");
        gap.style.height = "20px";
        gridDiv.appendChild(gap);
      }
    });
  }
});
  document.getElementById("reset-button").addEventListener("click", () => {
    splitPoints = [];
    rowSplitPoints = [];
    const originalText = gridDiv.innerText.replace(/\s+$/, "");
    gridDiv.innerHTML = originalText;
    gridDiv.style.display = "";
    gridDiv.style.gridTemplateColumns = "";
    gridDiv.style.gridTemplateRows = "";
  });
  </script>
  <script src="js/loadingTransition.js"></script>
  <script src="floatingWindow.js"></script>
</body>
</html>